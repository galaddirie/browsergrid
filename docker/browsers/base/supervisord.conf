[supervisord]
nodaemon=true
user=root
loglevel=info
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[program:xvfb]
priority=10
directory=/
command=/usr/bin/Xvfb %(ENV_DISPLAY)s -screen 0 %(ENV_RESOLUTION_WIDTH)sx%(ENV_RESOLUTION_HEIGHT)sx%(ENV_RESOLUTION_DEPTH)s -ac +extension RANDR +render
environment=DISPLAY="%(ENV_DISPLAY)s"
environment=RESOLUTION_WIDTH="%(ENV_RESOLUTION_WIDTH)s"
environment=RESOLUTION_HEIGHT="%(ENV_RESOLUTION_HEIGHT)s"
environment=RESOLUTION_DEPTH="%(ENV_RESOLUTION_DEPTH)s"
user=root
autostart=true
autorestart=true
stopsignal=TERM
stopwaitsecs=10
stdout_logfile=/var/log/xvfb.log
stderr_logfile=/var/log/xvfb.err

[program:nginx]
priority=30
directory=/
command=bash -c "/usr/local/bin/setup_nginx.sh && /usr/sbin/nginx -g 'daemon off;'"
autostart=true
autorestart=true
stopsignal=TERM
stopwaitsecs=10
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:browsermux]
priority=40
directory=/home/user
command=/usr/local/bin/browsermux
environment=BROWSER_URL="ws://localhost:%(ENV_REMOTE_DEBUGGING_PORT)s/devtools/browser",PORT="8080",MAX_MESSAGE_SIZE="1048576",CONNECTION_TIMEOUT_SECONDS="10"
user=browseruser
autostart=true
autorestart=true
stopsignal=TERM
stopwaitsecs=10
stdout_logfile=/var/log/browsermux.log
stderr_logfile=/var/log/browsermux.err

[program:stream_server]
priority=35
directory=/opt/browsergrid
command=/usr/bin/node /opt/browsergrid/stream-server.js
environment=DISPLAY="%(ENV_DISPLAY)s",RESOLUTION_WIDTH="%(ENV_RESOLUTION_WIDTH)s",RESOLUTION_HEIGHT="%(ENV_RESOLUTION_HEIGHT)s",STREAM_SERVER_PORT="%(ENV_STREAM_SERVER_PORT)s",STREAM_BITRATE="%(ENV_STREAM_BITRATE)s",STREAM_CODEC_MODE="%(ENV_STREAM_CODEC_MODE)s",STREAM_FPS="%(ENV_STREAM_FPS)s"
user=browseruser
autostart=true
autorestart=true
stopsignal=TERM
stopwaitsecs=10
stdout_logfile=/var/log/stream-server.log
stderr_logfile=/var/log/stream-server.err
